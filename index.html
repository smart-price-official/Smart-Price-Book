<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Smart Price v19.9.43 DIAG</title>

<script>
/* ===== SSOT ===== */
window.APP_VERSION = 'v19.9.43';
window.BUILD_ID = '2026-02-06_stable_diag';
</script>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#111;
  color:#fff;
  padding:20px;
}
.toast {
  background:#222;
  border-left:4px solid #0f0;
  padding:10px;
  margin:8px 0;
  font-size:14px;
}
.err { border-color:#f00; }
.warn { border-color:#ff0; }
</style>
</head>

<body>

<h2>Smart Price 診断モード</h2>
<div id="out"></div>

<script>
(function(){
  const isDebug = new URL(location.href).searchParams.get('debug') === '1';
  if (!isDebug) {
    document.getElementById('out').innerHTML =
      '<div class="toast err">debug=1 が付いていません</div>';
    return;
  }

  const out = (msg, cls='') => {
    const d = document.createElement('div');
    d.className = 'toast ' + cls;
    d.textContent = msg;
    document.getElementById('out').appendChild(d);
  };

  /* VERSION */
  out('VERSION = ' + (window.APP_VERSION || 'UNKNOWN'));

  /* BUILD */
  out('BUILD = ' + (window.BUILD_ID || 'UNKNOWN'));

  /* ServiceWorker */
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(r=>{
      out(
        r.length
          ? 'ServiceWorker = ON（キャッシュ原因）'
          : 'ServiceWorker = OFF',
        r.length ? 'err' : ''
      );
    });
  }

  /* lastStore */
  out(
    localStorage.getItem('lastStore')
      ? 'lastStore = 残っている（自動選択の原因）'
      : 'lastStore = なし',
    localStorage.getItem('lastStore') ? 'warn' : ''
  );
})();
</script>

</body>
</html>
