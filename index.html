<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Smart Price v19.9.43 (STABLE)</title>

<script>
/* ===== SSOT ===== */
window.APP_VERSION = 'v19.9.43';
window.BUILD_ID = '2026-02-06_stable_diag';
</script>

<style>
body { font-family: system-ui, sans-serif; background:#111; color:#fff; margin:0; padding:0; }
header { background:#b00000; padding:12px; font-weight:bold; }
#debug-indicator {
  position:fixed; top:6px; right:6px;
  width:8px; height:8px; background:#f00;
  display:none; z-index:9999;
}
.toast {
  position:fixed; right:10px; top:60px;
  background:#222; border-left:4px solid #0f0;
  padding:10px; margin-bottom:6px;
  font-size:12px; z-index:9998;
}
.toast.err { border-color:#f00; }
.toast.warn { border-color:#ff0; }
</style>
</head>

<body>

<div id="debug-indicator"></div>
<header>Smart Price <span id="ver"></span></header>

<main style="padding:16px">
  <p>通常表示（stable）</p>
</main>

<script>
(function(){
  const params = new URL(location.href).searchParams;
  const isDebug = params.get('debug') === '1';
  document.getElementById('ver').textContent =
    window.APP_VERSION + ' / ' + window.BUILD_ID;

  const toast = (msg, cls='') => {
    const d = document.createElement('div');
    d.className = 'toast ' + cls;
    d.textContent = msg;
    document.body.appendChild(d);
  };

  if (!isDebug) return;

  document.getElementById('debug-indicator').style.display = 'block';

  toast('VERSION=' + (window.APP_VERSION||'UNKNOWN'));
  toast('BUILD=' + (window.BUILD_ID||'UNKNOWN'));

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then(r=>{
      toast(
        r.length ? 'ServiceWorker=ON (cache)' : 'ServiceWorker=OFF',
        r.length ? 'err' : ''
      );
    });
  }

  const ls = localStorage.getItem('lastStore');
  toast(
    ls ? 'lastStore=残存 → 自動選択原因' : 'lastStore=なし',
    ls ? 'warn' : ''
  );
})();
</script>

</body>
</html>
