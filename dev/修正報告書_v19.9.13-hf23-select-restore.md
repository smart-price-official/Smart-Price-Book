# 🔧 Smart Price 修正報告書

**TO**: ユイ（監督）、なべさん（実機検証）  
**FROM**: Rex  
**DATE(JST)**: 2026-01-14 13:10 JST  
**VERSION**: v19.9.13-hf23-select-restore  
**BUILD_ID**: 2026-01-14_1310_select-restore

---

## 📋 今回の修正スコープ

**方針**: DOM追加や配置変更は禁止。CSSと既存classの付け外しのみで対応。

**要望**: 購入履歴を選択した時の「赤枠」と「薄い赤い下地」を v19.9.10以前の体感に戻す。

---

## ✅ 実施内容（2件）

### 1️⃣ CSSに `.selected` を追加（outline方式）

**対象**: `<style>` セクション

**追加したCSS**:
```css
/* ✅ 購入履歴選択時の赤枠＋薄赤背景（outline方式） */
.selected {
  outline: 2px solid #ff5252;
  outline-offset: -2px;
  background: rgba(213,0,0,0.12);
}
```

**特徴**:
- `outline` を使用することで、レイアウトに影響を与えない
- `outline-offset: -2px` で枠を内側に配置
- `background` で薄い赤い下地を追加
- v19.9.10以前の体感を再現

---

### 2️⃣ 選択ロジックの追加

**対象**: `renderHistory()` 関数内のクリックイベント

**変更前**:
```javascript
div.onclick = () => openForm(it.code);
```

**変更後**:
```javascript
div.onclick = (e) => {
  // ✅ 他の選択を解除
  document.querySelectorAll('.price-card.selected').forEach(el => el.classList.remove('selected'));
  // ✅ 自分を選択
  div.classList.add('selected');
  openForm(it.code);
};
```

**効果**:
- クリック時に他の選択を自動的に解除
- クリックした行に `selected` クラスを付与
- DOM構造は変更なし（class の付け外しのみ）

---

## 📦 デプロイ先

**対象ファイル**: `Smart-Price-Book/dev/index.html`

**デプロイURL**:

### 通常URL（実機テスト用）
```
https://takecwatanabe-dev.github.io/Smart-Price-Book/dev/?b=2026-01-14_1310_select-restore
```

### デバッグURL（詳細ログ確認用）
```
https://takecwatanabe-dev.github.io/Smart-Price-Book/dev/?b=2026-01-14_1310_select-restore&debug=1
```

---

## 🧪 検証推奨項目（なべさん向け）

| 項目 | 確認内容 | 期待結果 |
|------|----------|----------|
| 1. 赤枠表示 | 購入履歴をクリック | クリックした行に赤い枠が表示される |
| 2. 薄赤背景 | 購入履歴をクリック | クリックした行の背景が薄い赤色になる |
| 3. 単一選択 | 複数の行をクリック | 常に1行だけが選択状態（前の選択は自動解除） |
| 4. レイアウト | 選択前後でレイアウトを確認 | レイアウトがずれない（`outline` 方式のため） |
| 5. フォーム表示 | 選択後のフォーム表示 | 正常に商品編集フォームが開く |

---

## 📝 変更履歴

```
VERSION: v19.9.13
FULL_VERSION: v19.9.13-hf23-select-restore
DATE(JST): 2026-01-14 13:10 JST
TITLE: 履歴選択の赤枠＋薄赤背景を復活（CSSのみ・最小差分）

CHANGES:
- 購入履歴選択時の赤枠＋薄赤背景を復活（outline方式で実装）
- クリック時に .selected クラスを付け外しするロジックを追加
- DOM追加や配置変更なし（CSSと既存classの付け外しのみ）

AUTHOR: Rex
BUILD_ID: 2026-01-14_1310_select-restore
POLICY: UI変更禁止（CSS変更のみ）
```

---

## ✅ 完了確認

- [x] CSSに `.selected` を追加（outline方式）
- [x] クリック時の選択ロジックを追加
- [x] レイアウト影響なしを確認（outline方式）
- [x] バージョン情報更新（v19.9.13-hf23-select-restore）
- [x] リンターエラー確認（0件）
- [x] 修正報告書作成

---

## 💡 技術メモ

**`outline` vs `border` の違い**:
- `border`: ボックスモデルの一部なので、レイアウトに影響を与える
- `outline`: ボックスモデルの外側に描画されるため、レイアウトに影響を与えない
- `outline-offset: -2px`: 枠を内側に配置することで、疑似的に `border` のような見た目を実現

**選択ロジックの設計**:
- シングルセレクション（単一選択）のみをサポート
- `querySelectorAll` で既存の選択を一括解除
- `classList.add/remove` でクラスの付け外し

---

**次のステップ**: なべさんによる実機検証（Android + iOS）
